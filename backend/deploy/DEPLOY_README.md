# üöÄ –ê–≤—Ç–æ–¥–µ–ø–ª–æ–π ShortsAI Studio

–ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–µ–ø–ª–æ–π –Ω–∞ Synology NAS —á–µ—Ä–µ–∑ VPS.

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤

```
backend/deploy/
‚îú‚îÄ‚îÄ config.sh                      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–∏–∑–º–µ–Ω–∏—Ç–µ –ø–æ–¥ —Å–µ–±—è)
‚îú‚îÄ‚îÄ vps_setup.sh                   # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VPS (–æ–¥–∏–Ω —Ä–∞–∑)
‚îú‚îÄ‚îÄ synology_deploy.sh             # –î–µ–ø–ª–æ–π –Ω–∞ Synology
‚îú‚îÄ‚îÄ synology_env_edit_helper.sh    # –ü–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è .env
‚îú‚îÄ‚îÄ full_deploy.sh                 # –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç (–û–î–ù–ê –ö–û–ú–ê–ù–î–ê)
‚îî‚îÄ‚îÄ DEPLOY_README.md               # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üîß –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–æ–¥–∏–Ω —Ä–∞–∑)

### 1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

–û—Ç–∫—Ä–æ–π—Ç–µ `backend/deploy/config.sh` –∏ –∏–∑–º–µ–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```bash
# VPS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
export VPS_IP="159.255.37.158"           # –í–∞—à VPS IP
export VPS_HOST="vm3737624.firstbyte.club"  # –î–æ–º–µ–Ω–Ω–æ–µ –∏–º—è VPS (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
export VPS_USER="root"                  # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å VPS

# Synology –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
export SYNO_HOST="192.168.100.222"      # –õ–æ–∫–∞–ª—å–Ω—ã–π IP Synology
export SYNO_USER="admin"                 # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Synology

# GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–ó–ê–ü–û–õ–ù–ò–¢–ï –°–í–û–ô URL!)
export GITHUB_REPO_URL="https://github.com/hotwellkz/p041.git"
export GITHUB_BRANCH="main"

# –ü–æ—Ä—Ç—ã
export BACKEND_PORT="8080"               # –ü–æ—Ä—Ç –Ω–∞ Synology
export VPS_PUBLIC_PORT="5000"           # –ü—É–±–ª–∏—á–Ω—ã–π –ø–æ—Ä—Ç –Ω–∞ VPS –¥–ª—è backend
```

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSH –¥–æ—Å—Ç—É–ø

**–í–∞—Ä–∏–∞–Ω—Ç A: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (–ø—Ä–æ—â–µ)**

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ SSH –¥–æ—Å—Ç—É–ø–µ–Ω —Å –ø–∞—Ä–æ–ª—è–º–∏:
- VPS: `ssh root@159.255.37.158` (–≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å)
- Synology: `ssh admin@192.168.100.222` (–≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å)

**–í–∞—Ä–∏–∞–Ω—Ç B: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SSH –∫–ª—é—á–µ–π (–±–µ–∑–æ–ø–∞—Å–Ω–µ–µ)**

1. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ SSH –∫–ª—é—á–∏ (–µ—Å–ª–∏ –µ—â—ë –Ω–µ—Ç):
   ```bash
   ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
   ```

2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ VPS:
   ```bash
   ssh-copy-id root@159.255.37.158
   ```

3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ Synology:
   ```bash
   ssh-copy-id admin@192.168.100.222
   ```

4. –î–æ–±–∞–≤—å—Ç–µ –≤ `config.sh`:
   ```bash
   export VPS_SSH_KEY_PATH="~/.ssh/id_rsa"
   export SYNO_SSH_KEY_PATH="~/.ssh/id_rsa"
   ```

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env –Ω–∞ Synology

–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –¥–µ–ø–ª–æ—è –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` –Ω–∞ Synology:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ Synology
ssh admin@192.168.100.222

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
cd /volume1/shortsai/app/backend
bash deploy/synology_env_edit_helper.sh

# –ò–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –Ω–∞–ø—Ä—è–º—É—é
nano /volume1/shortsai/app/backend/.env
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ .env:**

```env
NODE_ENV=production
PORT=8080
STORAGE_ROOT=/volume1/shortsai/videos
BACKEND_URL=http://159.255.37.158:5000
# –ò–õ–ò –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–æ–º–µ–Ω:
# BACKEND_URL=http://vm3737624.firstbyte.club:5000

# Firebase (–æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)
FIREBASE_SERVICE_ACCOUNT={"type":"service_account",...}
# –ò–õ–ò
FIREBASE_PROJECT_ID=your-project-id
FIREBASE_CLIENT_EMAIL=your-service-account@project.iam.gserviceaccount.com
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"

# Telegram
TELEGRAM_API_ID=your-api-id
TELEGRAM_API_HASH=your-api-hash
TELEGRAM_SESSION_SECRET=64-char-hex-string
SYNX_CHAT_ID=your-syntx-chat-id
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π (–û–î–ù–ê –ö–û–ú–ê–ù–î–ê)

**Linux/macOS/Git Bash:**
```bash
cd backend/deploy
chmod +x *.sh
./full_deploy.sh
```

**Windows PowerShell:**
```powershell
cd backend\deploy
bash full_deploy.sh
```

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –¥–ª—è Windows:** –í PowerShell –∫–æ–º–∞–Ω–¥–∞ `chmod` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `bash full_deploy.sh` –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Git Bash/WSL.

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. ‚úÖ –ü–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ VPS –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç –µ–≥–æ (–µ—Å–ª–∏ –ø–µ—Ä–≤—ã–π —Ä–∞–∑)
2. ‚úÖ –ü–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ Synology –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç –¥–µ–ø–ª–æ–π
3. ‚úÖ –û–±–Ω–æ–≤–∏—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–∑ GitHub
4. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç TypeScript
5. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç .env (–µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç)
6. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç backend —á–µ—Ä–µ–∑ pm2
7. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

### –û—Ç–¥–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ VPS (–æ–¥–∏–Ω —Ä–∞–∑):**

```bash
# –° –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
scp backend/deploy/vps_setup.sh root@159.255.37.158:/root/
ssh root@159.255.37.158
bash /root/vps_setup.sh
```

**–î–µ–ø–ª–æ–π –Ω–∞ Synology:**

```bash
# –° –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
scp backend/deploy/synology_deploy.sh admin@192.168.100.222:/tmp/
ssh admin@192.168.100.222
bash /tmp/synology_deploy.sh
```

**–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ .env:**

```bash
# –ù–∞ Synology
cd /volume1/shortsai/app/backend
bash deploy/synology_env_edit_helper.sh
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –ù–∞ Synology
ssh admin@192.168.100.222
pm2 logs shortsai-backend

# –ò–ª–∏ —á–µ—Ä–µ–∑ tail
tail -f /volume1/shortsai/logs/backend.log
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–º

```bash
# –ù–∞ Synology
ssh admin@192.168.100.222

# –°—Ç–∞—Ç—É—Å
pm2 status

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
pm2 restart shortsai-backend

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
pm2 stop shortsai-backend

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
pm2 logs shortsai-backend
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# Health check
curl http://159.255.37.158:5000/health
# –ò–õ–ò
curl http://vm3737624.firstbyte.club:5000/health

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: {"ok":true}
```

## üîç –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### Backend –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
   ```bash
   ssh admin@192.168.100.222 'pm2 logs shortsai-backend --lines 50'
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env:
   ```bash
   ssh admin@192.168.100.222 'cat /volume1/shortsai/app/backend/.env | grep -v "^#" | grep -v "^$"'
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–º–ø–∏–ª—è—Ü–∏—é:
   ```bash
   ssh admin@192.168.100.222 'cd /volume1/shortsai/app/backend && npm run build'
   ```

### SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:
   ```bash
   ping 192.168.100.222
   ssh -v admin@192.168.100.222
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –Ω–∞ Synology:
   - Control Panel ‚Üí Terminal & SNMP ‚Üí Enable SSH service
   - –ü–æ—Ä—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 22

### –ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ iptables –Ω–∞ VPS:
   ```bash
   ssh root@159.255.37.158
   iptables -t nat -L PREROUTING -n -v
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Synology —Å VPS:
   ```bash
   ssh root@159.255.37.158
   ping 192.168.100.222
   # –∏–ª–∏ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è VPN:
   ping 10.8.0.2
   ```

3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤:
   ```bash
   ssh root@159.255.37.158
   systemctl restart synology-port-forward.service
   ```

### Backend –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –ø—É–±–ª–∏—á–Ω–æ–º URL

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ Synology:
   ```bash
   ssh admin@192.168.100.222
   curl http://127.0.0.1:8080/health
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å VPS:
   ```bash
   ssh root@159.255.37.158
   curl http://192.168.100.222:8080/health
   # –∏–ª–∏ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è VPN:
   curl http://10.8.0.2:8080/health
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–Ω–∞—Ä—É–∂–∏:
   ```bash
   curl http://159.255.37.158:5000/health
   ```

## üìù –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π —Å–Ω–æ–≤–∞:

```bash
cd backend/deploy
./full_deploy.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –û–±–Ω–æ–≤–∏—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–∑ GitHub
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ü–µ—Ä–µ—Å–æ–±–µ—Ä—ë—Ç TypeScript
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç backend —á–µ—Ä–µ–∑ pm2

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSH –∫–ª—é—á–∏** –≤–º–µ—Å—Ç–æ –ø–∞—Ä–æ–ª–µ–π
2. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ SSH –¥–æ—Å—Ç—É–ø** —Ç–æ–ª—å–∫–æ —Å –≤–∞—à–µ–≥–æ IP (—á–µ—Ä–µ–∑ firewall)
3. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ** —Å–∏—Å—Ç–µ–º—É –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
4. **–ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã** –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ .env)
5. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS** –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (–Ω–∞—Å—Ç—Ä–æ–π—Ç–µ nginx –Ω–∞ VPS)

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `pm2 logs shortsai-backend`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: `cat backend/deploy/config.sh`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env: `cat /volume1/shortsai/app/backend/.env`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: `pm2 status`

---

**–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –¥–µ–ø–ª–æ–π ‚Äî —ç—Ç–æ –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞! üöÄ**
